<div class="purchase-container">
  <!-- Sidebar with Search -->
  <div class="search-sidebar">
    <h3>Search</h3>
    <form (ngSubmit)="search()">
      <div>
        <label for="searchQuery">Search by:</label>
        <select id="searchQuery" [(ngModel)]="searchType" name="searchQuery" required>
          <option value="invoice">Invoice Number</option>
          <option value="supplier">Supplier</option>
          <option value="product">Product</option>
        </select>
      </div>

      <div>
        <label for="searchInput">Search:</label>
        <input
          type="text"
          id="searchInput"
          [(ngModel)]="searchText"
          name="searchInput"
          placeholder="Enter search query"
          required
        />
      </div>

      <button type="submit">Search</button>
    </form>

    <!-- Display filtered results here -->
    <div *ngIf="filteredResults.length > 0">
      <h4>Search Results:</h4>
      <div class="filtered-result-container">
        <div
          *ngFor="let result of filteredResults"
          class="filtered-result-item"
        >
          <div class="result-window">
            <!-- Customize to show necessary information -->
            <p><strong>Invoice Number:</strong> {{ result.invoiceNumber }}</p>
            <p><strong>Supplier:</strong> {{ result.supplier }}</p>
            <p><strong>Total Amount:</strong> ${{ result.totalAmount }}</p>

            <!-- Edit and Delete Buttons -->
            <div class="result-actions">
              <button type="button" (click)="editPurchase(result)">
                Edit
              </button>
              <button type="button" (click)="deletePurchase(result.id)">
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Purchase Form -->
  <div class="purchase-form">
    <form (ngSubmit)="createPurchase()">
      <!-- Purchase Date Input -->
      <div>
        <label for="purchaseDate">Purchase Date:</label>
        <input
          type="date"
          id="purchaseDate"
          [(ngModel)]="purchaseDate"
          name="purchaseDate"
          required
        />
      </div>

      <!-- Supplier Selection Dropdown -->
      <div>
        <label for="supplierId">Supplier:</label>
        <select
          id="supplierId"
          [(ngModel)]="selectedSupplierId"
          name="supplierId"
          required
        >
          <option *ngFor="let supplier of suppliers" [value]="supplier.id">
            {{ supplier.name }}
          </option>
        </select>
      </div>

      <!-- Product Selection -->
      <div>
        <label for="productSelect">Product:</label>
        <select
          id="productSelect"
          [(ngModel)]="selectedProductId"
          name="productSelect"
          (change)="onProductSelect()"
          required
        >
          <option value="">-- Select Product --</option>
          <option *ngFor="let product of products" [value]="product.id">
            {{ product.name }} - ${{ product.price }}
          </option>
          <option value="new">+ Add New Product</option>
        </select>
      </div>

      <!-- Product Details (For Selected or New Product) -->
      <div *ngIf="selectedProductId">
        <div>
          <label for="productName">Product Name:</label>
          <input
            type="text"
            id="productName"
            [(ngModel)]="newProduct.name"
            name="productName"
            [readonly]="selectedProductId !== 'new'"
            required
          />
        </div>

        <div>
          <label for="productPrice">Product Price ($):</label>
          <input
            type="number"
            id="productPrice"
            [(ngModel)]="newProduct.price"
            name="productPrice"
            [readonly]="selectedProductId !== 'new'"
            required
          />
        </div>

        <div>
          <label for="stockThreshold">Stock Threshold:</label>
          <input
            type="number"
            id="StockThreshold"
            [(ngModel)]="newProduct.stockThreshold"
            name="stockThreshold"
            [readonly]="selectedProductId !== 'new'"
            required
          />
        </div>

        <div>
          <label for="productQuantity">Quantity:</label>
          <input
            type="number"
            id="productQuantity"
            [(ngModel)]="newProduct.stockQuantity"
            name="productQuantity"
            min="1"
            required
          />
        </div>

        <button type="button" (click)="addProductToPurchase()">Add to Purchase</button>
      </div>

      <!-- List of Added Products -->
      <div>
        <h3>Purchase List</h3>
        <ul>
          <li *ngFor="let item of newPurchaseData.purchase.products">
            {{ item.product.name }} - ${{ item.product.price }} x {{ item.quantity }}
            <button type="button" (click)="removeProductFromPurchase(item.product)">Remove</button>
          </li>
        </ul>
      </div>

      <!-- Total Amount -->
      <div>
        <label for="totalAmount">Total Amount:</label>
        <input
          type="text"
          id="totalAmount"
          [value]="calculateTotalAmount()"
          readonly
        />
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        [disabled]="!purchaseDate || !selectedSupplierId || newPurchaseData.purchase.products.length === 0"
      >
        Create Purchase
      </button>
    </form>
  </div>
</div>
