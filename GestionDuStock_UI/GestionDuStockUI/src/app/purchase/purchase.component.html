<div class="purchase-container">
  <!-- Sidebar with Search -->
  <div class="search-sidebar">
    <h3>Search</h3>
    <form (ngSubmit)="search()">
      <div>
        <label for="searchQuery">Search by:</label>
        <div class="input-with-icon">
          <i class="pi pi-search-plus"></i>
          <select id="searchQuery" [(ngModel)]="searchType" name="searchQuery" required>
            <option value="invoice">Invoice Number</option>
            <option value="supplier">Supplier</option>
            <option value="product">Product</option>
          </select>
        </div>
      </div>
      <div>
        <label for="searchInput">Search:</label>
        <div class="input-with-icon">
          <i class="pi pi-search"></i>
          <input
            type="text"
            id="searchInput"
            [(ngModel)]="searchText"
            name="searchInput"
            placeholder="Enter search query"
            required
          />
        </div>
      </div>

      <button type="submit"><i class="pi pi-search"></i> Search</button>
    </form>

    <div *ngIf="filteredResults.length > 0">
      <h4>Search Results:</h4>
      <div class="filtered-result-container">
        <div *ngFor="let result of filteredResults" class="filtered-result-item">
          <div class="result-window">
            <p>
              <strong>Invoice Number:</strong>
              <i class="pi pi-file-invoice"></i> {{ result.invoiceNumber }}
            </p>
                ---------------------------------------
              <div *ngFor="let item of result.purchaseItems">
                <i class="pi pi-box"></i> {{ item.name }} <br>
                <span class="item-details">
          <i class="pi pi-caret-up"></i> Quantity: {{ item.quantity }} <br>
          <i class="pi pi-dollar"></i> Price: ${{ item.price }}
        </span>
                ---------------------------------------
              </div>

            <p>
              <strong>Supplier:</strong>
              <i class="pi pi-briefcase"></i> {{ result.supplierName }}
            </p>

            <p>
              <strong>Total Amount:</strong>
              <i class="pi pi-wallet"></i> ${{ result.totalAmount }}
            </p>

            <div [class.hidden]="!isAdmin" class="result-actions">
              <button type="button" (click)="editPurchase(result)">
                <i class="pi pi-pencil"></i> Edit
              </button>
              <button type="button" (click)="deletePurchase(result.invoiceNumber)">
                <i class="pi pi-trash"></i> Delete
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Purchase Form -->
  <div class="purchase-form">
    <h2>{{ editingPurchase ? 'Edit Purchase' : 'Create New Purchase' }}</h2>
    <form (ngSubmit)="editingPurchase ? updatePurchase() : createPurchase()">
      <div>
        <label for="purchaseDate">Purchase Date:</label>
        <div class="input-with-icon">
          <i class="pi pi-calendar-clock"></i>
          <input
            type="date"
            id="purchaseDate"
            [(ngModel)]="purchaseDate"
            name="purchaseDate"
            required
          />
        </div>
      </div>

      <div>
        <label for="supplierId">Supplier:</label>
        <div class="input-with-icon">
          <i class="pi pi-briefcase"></i>
          <select
            id="supplierId"
            [(ngModel)]="selectedSupplierId"
            name="supplierId"
            required
          >
            <option value="">-- Select Supplier --</option>
            <option *ngFor="let supplier of activeSuppliers" [value]="supplier.id">
              {{ supplier.name }}
            </option>
          </select>
        </div>
      </div>

      <div>
        <label for="productSelect">Product:</label>
        <div class="input-with-icon">
          <i class="pi pi-cog"></i>
          <select
            id="productSelect"
            [(ngModel)]="selectedProductId"
            name="productSelect"
            (change)="onProductSelect()"
            required
          >
            <option value="">-- Select Product --</option>
            <option *ngFor="let product of products" [value]="product.id">
              {{ product.name }} - ${{ product.price }}
            </option>
            <option value="new">+ Add New Product</option>
          </select>
        </div>
      </div>

      <div *ngIf="selectedProductId">
        <div>
          <label for="productName">Product Name:</label>
          <div class="input-with-icon">
            <i class="pi pi-tag"></i>
            <input
              type="text"
              id="productName"
              [(ngModel)]="newProduct.name"
              name="productName"
              [readonly]="selectedProductId !== 'new'"
              required
            />
          </div>
        </div>

        <div>
          <label for="productPrice">Product Price ($):</label>
          <div class="input-with-icon">
            <i class="pi pi-dollar"></i>
            <input
              type="number"
              id="productPrice"
              [(ngModel)]="newProduct.price"
              name="productPrice"
              [readonly]="selectedProductId !== 'new'"
              required
              min="0.01"
              step="0.01"
            />
          </div>
        </div>

        <div>
          <label for="stockThreshold">Stock Threshold:</label>
          <div class="input-with-icon">
            <i class="pi pi-arrow-down"></i>
            <input
              type="number"
              id="stockThreshold"
              [(ngModel)]="newProduct.stockThreshold"
              name="stockThreshold"
              [readonly]="selectedProductId !== 'new'"
              required
              min="1"
            />
          </div>
        </div>

        <div>
          <label for="productQuantity">Quantity:</label>
          <div class="input-with-icon">
            <i class="pi pi-caret-up"></i>
            <input
              type="number"
              id="productQuantity"
              [(ngModel)]="newProduct.stockQuantity"
              name="productQuantity"
              min="1"
              required
            />
          </div>
        </div>

        <button type="button" (click)="addProductToPurchase()">
          <i class="pi pi-plus"></i> Add to Purchase
        </button>
      </div>

      <div *ngIf="newPurchaseData.purchase.products.length > 0">
        <h3>Purchase Items</h3>
        <ul class="purchase-items-list">
          <li *ngFor="let item of newPurchaseData.purchase.products" class="purchase-item">
            <span class="item-name">{{ item.product.name }}</span>
            <span class="item-details">
              ${{ item.product.price | number:'1.2-2' }} Ã— {{ item.quantity }} =
              ${{ (item.product.price * item.quantity) | number:'1.2-2' }}
            </span>
            <button type="button" (click)="removeProductFromPurchase(item.product)" class="remove-item">
              <i class="pi pi-trash"></i>
            </button>
          </li>
        </ul>
      </div>

      <div class="total-amount">
        <label>Total Amount:</label>
        <span>${{ calculateTotalAmount() | number:'1.2-2' }}</span>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="!purchaseDate || !selectedSupplierId || newPurchaseData.purchase.products.length === 0">
          <i class="pi pi-check"></i> {{ editingPurchase ? 'Update' : 'Create' }} Purchase
        </button>

        <button *ngIf="editingPurchase" type="button" (click)="resetPurchaseForm()" class="cancel-button">
          <i class="pi pi-times"></i> Cancel
        </button>
      </div>
    </form>

  </div>
  <div class="csv-import">
    <h3>Import Purchases from CSV</h3>
    <input type="file" (change)="onFileChange($event)" accept=".csv" />
  </div>
  <div class="csv-import">
    <h3>Export Purchases in CSV</h3>
    <Button (click)="exportToCSV()">Export CSV</Button>
  </div>


</div>
